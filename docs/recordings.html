<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">

    <title>recordings page</title>
    <script
    src="https://code.jquery.com/jquery-3.5.1.js"
    integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
    crossorigin="anonymous">
    </script>
  </head>
  <body style="background-color: powderblue; font-family: Candara;">

    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #e3f2fd;">
        <div class="container-fluid">
          <a class="navbar-brand fw-bold" href="#">Wakashan Consortium</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active fw-bold" aria-current="page" href="#">Recordings</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="about.html">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="faq.html">FAQs</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contactus.html">Contact Us</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

    <h1 class="fw-bold text-center">Recording Center</h1>
    <br>

    <h2 class="mx-5 text-decoration-underline">1. Log In Here</h2>
    <form class="px-5 row g-3 needs-validation" novalidate>
      <div class="col-md-4">
        <label for="validationFirstName" class="form-label">First name</label>
        <input type="text" class="form-control" id="validationFirstName" placeholder="Peter" required>
        <div class="invalid-feedback">
          Please enter your first name.
        </div>
      </div>
      <div class="col-md-4">
        <label for="validationLastName" class="form-label">Last name</label>
        <input type="text" class="form-control" id="validationLastName" placeholder="Parker" required>
        <div class="invalid-feedback">
          Please enter your last name.
        </div>
      </div>
      <div class="col-md-4">
        <label for="validationCustomEmail" class="form-label">Email</label>
        <div class="input-group has-validation">
          <input type="text" class="form-control" id="validationCustomEmail" placeholder="spiderman@gmail.com" required>
          <div class="invalid-feedback">
            Please enter your email.
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <label for="validationAge" class="form-label">Age</label>
        <div class="input-group has-validation">
          <input type="text" class="form-control" id="validationAge" placeholder="16" required>
          <div class="invalid-feedback">
            Please enter your age.
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <label for="validationExperience" class="form-label">Years of Experience</label>
        <div class="input-group has-validation">
          <input type="text" class="form-control" id="validationExperience" placeholder="0" required>
          <div class="invalid-feedback">
            Please enter how many years of experience you have with Makah.
          </div>
        </div>
      </div>
      <div class="col-12">
        <p>Gender</p>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genders" id="radioFemale" value="Female">
          <label class="form-check-label" for="radioFemale">Female</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genders" id="radioMale" value="Male">
          <label class="form-check-label" for="radioMale">Male</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genders" id="radioNB" value="Non-Binary">
          <label class="form-check-label" for="radioNB">Non-Binary</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="genders" id="radioNA" value="other">
          <label class="form-check-label" for="radioNA">Prefer Not to Answer</label>
        </div>      
      </div>
      <div class="col-12">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" value="" id="invalidCheck" required>
          <label class="form-check-label" for="invalidCheck">
            Agree to terms and conditions
          </label>
          <div class="invalid-feedback">
            You must agree before submitting.
          </div>
        </div>
      </div>
      <div class="col-12">
          <button id="login" class="btn btn-outline-dark" type="button">Log In</button>
      </div>
    </form>

    <br>
    <br>

    <h2 class="mx-5 text-decoration-underline">2. Record and Submit Your Prompt:</h2>
    <h4 class="mx-5">Here's your phrase/sentence in Makah, you can record as many times
      as you like and then submit when you feel satisfied with your recording.
    </h4>
    <p id="makah_phrase" class="mx-5 fs-1">Log in to get your prompt</p>
    
    <div class="wrapper px-5 text-center">
      <section class="main-controls">
        <canvas class="visualizer" height="60px"></canvas>
        <div id="buttons" >
          <button id= "record" type="button" class="record btn btn-outline-dark">Record</button>
          <button id ="stop" type="button" class="stop btn btn-outline-dark">Stop</button>
          <button id = "submit1" type="button" class="submit btn btn-outline-dark">Submit</button>
        </div>
      </section>
      <br>
      <section class="sound-clips">


      </section>

    </div>

    <br>
    <br>

    <h4 class="mx-5">Want another prompt? Click the button below.</h4>
    <button id = "new_prompt" type="button" class="mx-5 btn btn-outline-dark">New Prompt</button>

    <br>
    <br>
    <br>


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    -->
    <script src="apps.js"></script> 
    <script> 

    function getRandomInt(max) {
      return Math.floor(Math.random() * max); //The maximum is exclusive and the minimum is inclusive
    }

    previous_indices = []
    out_of_phrases = false
    logged_in = false
    current_phrase_id = "None"

    function getPrompt(){ //generates and displays Makah phrase
      $.getJSON("words.json", function(data){
        console.log("trying");
        random_index = getRandomInt(Object.keys(data.set_1).length + 1);
        while (previous_indices.includes(random_index)){
          random_index = getRandomInt(Object.keys(data.set_1).length + 1);
          if (previous_indices.length == Object.keys(data.set_1).length){
            out_of_phrases = true;
            break;
          }
        };
        if (out_of_phrases){
          $("#makah_phrase").text("You've seen all our phrases");
        console.log("done")
        }else{
        previous_indices.push(random_index);
        $("#makah_phrase").text(data.set_1[random_index].phrase);
        current_phrase_id = data.set_1[random_index].id
        console.log("done")}
      }); 
    }

    var input = {}

    function getGender(){
      gender_val = "No answer";
      if ($("#radioFemale").is(':checked')){
        gender_val = "female";
      } else if ($("#radioMale").is(':checked')){
        gender_val = "male";
      } else if ($("#radioNB").is(':checked')){
        gender_val = "non-binary";
      }
      return gender_val
    }

    $("#login").click(function(){ //records info when user logs in
      console.log("logged in");
      input.email = $("#validationCustomEmail").val();
      input.first = $("#validationFirstName").val();
      input.last = $("#validationLastName").val();
      input.age = $("#validationAge").val();
      input.experience = $("#validationExperience").val();
      input.gender = getGender();
      input.recordings = [];

      console.log(input);

      logged_in = true;

      getPrompt();

    })

    $("#submit1").click(function(){
      current_recording = {}
      console.log("submitted");
      const timeElapsed = Date.now();
      const today = new Date(timeElapsed);
      current_recording.timestamp = today.toUTCString();
      current_recording.phrase_id = current_phrase_id;
      input.recordings.push(current_recording);
      console.log(input)
    })

    $("#new_prompt").click(function(){ //generates new prompt when button is pushed
      if (logged_in){
        getPrompt(); 
      }
    })
    </script>
  </body>
</html>